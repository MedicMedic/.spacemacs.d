* Mac Os Mojave + DigitalOcean + Shadowsocks VPSæ­å»º&ä¼˜åŒ– 
ä¹‹å‰ä¸€ç›´ç”¨é‚£äº›å…æµçš„ä»˜è´¹vpnç¿»å¢™ï¼Œåˆæ…¢åˆä¸ç¨³å®šï¼ˆç•™ä¸‹äº†åˆæ‡’åˆè ¢çš„æ³ªæ°´ï¼‰ï¼Œåˆšå¥½å­¦äº†ã€Šè®¡ç®—æœºç½‘ç»œã€‹ï¼Œå°±æƒ³è¿™ä¸ªè‡ªå·±æ¥é…ç½®ä¸€ä¸ªvpsï¼Œåˆå¿«åˆç¨³å®šï¼Œå‚è€ƒäº†[[http://daipei.me/posts/cross_firewall_with_digitalocean_shadowsocks/]]ï¼Œè™½ç„¶ç¢°åˆ°äº†å¾ˆå¤šå›°éš¾ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯æˆåŠŸäº†ã€‚
ä¸‹é¢æˆ‘å°±å†™ä¸€ä¸‹æˆ‘çš„å…·ä½“æ“ä½œæ­¥éª¤ï¼Œä»¥åŠé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚
** æ³¨å†Œå¹¶ç§Ÿç”¨VPS
** é…ç½®VPS
*** è¿œç¨‹ç™»é™†æœåŠ¡å™¨
æ‰“å¼€ç»ˆç«¯è¾“å…¥ä»¥ä¸‹ä»£ç (æˆ‘ç”¨çš„æ˜¯ipv4çš„åœ°å€ï¼Œipv6å’Œprivate ipå¥½åƒéƒ½ä¸deiè¡Œï¼‰
#+begin_src shell
$ ssh root@[YOUR VPS IP ADDRESS]
#+end_src
*** å°éº»çƒ¦
æŒ‰é“ç†ä»¥ä¸Šä»£ç åº”è¯¥èƒ½å¤Ÿé¡ºåˆ©è¿æ¥ä¸Šè¿œç¨‹æœåŠ¡å™¨ï¼Œä½†æ˜¯å°±åœ¨æˆ‘é«˜å…´çš„æƒ³è¦è¿›è¡Œä¸‹ä¸€æ­¥çš„æ—¶å€™ï¼Œæˆ‘çš„ITermä¸Šå°±å‡ºç°çº¢è‰²çš„å¤§âŒ
#+begin_src shell
/Users/anthony/.ssh/config line 3: garbage at end of line; "-%r@%h:%p".
#+end_src
what?è¿™ä¸ªâ€œ-%r@%h:%pâ€æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œä¹Ÿå¤ªé¬¼ç•œäº†å§ï¼Œæˆ‘æ‰“å¼€~/.ssh/configèµ¶ç´§çœ‹äº†ä¸€çœ¼
#+begin_src shell
Host *
ControlMaster auto
ControlPath ~/.ssh/master -%r@%h:%p
ControlPersist = no%
#+end_src
ç½‘ä¸Šæ‰¾äº†ä¸€åœˆæ²¡æœ‰ä»»ä½•è§£ç­”ï¼Œé‚£å’‹åŠå—ï¼Œç›´æ¥åˆ æ‰233
#+begin_src shell
ControlPath ~/.ssh/master -%r@%h:%p
#+end_src
í ½í±‡
#+begin_src 
ControlPath ~/.ssh/master 
#+end_src
æˆåŠŸè¿æ¥ï¼
*** é…ç½®é˜²ç«å¢™ 
**** 1.å®‰è£…firewalld 
#+begin_src shell
$ yum install firewalld firewall-config
#+end_src
**** 2.å¯åŠ¨firewalld
#+begin_src shell
$ systemctl start firewalld
#+end_src
**** #ä¿®æ”¹SSHç«¯å£
#+begin_src shell
$ vi /usr/lib/firewalld/services/ssh.xml
#+end_src
å‡ºç°ä»¥ä¸‹çª—å£ï¼š
#+begin_src xml
<?xml version="1.0" encoding="utf-8"?>
ã€€ã€€<service>
ã€€ã€€ã€€ã€€<short>SSH</short>
   ã€€ã€€<description>Secure Shell (SSH) is a protocol for logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interfaceï¼Œ enable this option. You need the openssh-server package installed for this option to be useful.</description>
   ã€€ã€€<port protocol="tcp" port="22"/>
ã€€ã€€</service>
#+end_src
å¦‚æœæƒ³è¦ä¿®æ”¹ï¼Œå°† port="22" æ”¹ä¸º port="xxx" ï¼ˆå»ºè®®ä¸è¦ä¿®æ”¹ï¼‰
ä¿®æ”¹åé‡è½½firewalld
#+begin_src shell
$ firewall-cmd --permanent --add-service=ssh
$ firewall-cmd --reload
#+end_src
æ‰§è¡Œä¸Šè¿°å‘½ä»¤å¦‚æœæ˜¾ç¤ºFirewallD is not runningï¼Œä½¿ç”¨ systemctl start firewalld å¯åŠ¨é˜²ç«å¢™ã€‚

æ³¨æ„å¦‚æœåœ¨æ­å»ºå®Œæˆåæ— æ³•ç§‘å­¦ä¸Šç½‘ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯é˜²ç«å¢™å¯¼è‡´çš„ï¼Œå¿«é€Ÿå®šä½é—®é¢˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…³é—­é˜²ç«å¢™æµ‹è¯•ï¼š
#+begin_src shell
$ systemctl stop firewalld
#+end_src
å¦‚æœå…³é—­é˜²ç«å¢™åå¯ä»¥æ­£å¸¸ç§‘å­¦ä¸Šç½‘ï¼Œè¯´æ˜æ˜¯ç«¯å£æ²¡æœ‰æ­£ç¡®æ·»åŠ åˆ°é˜²ç«å¢™ä¸­ã€‚
*** å®‰è£…shadowsocks
**** 1.å®‰è£…pip
#+begin_src shell
$ yum install m2crypto python-setuptools
$ easy_install pip
#+end_src
**** 2.ä½¿ç”¨pipå®‰è£…shadowsocks
#+begin_src shell
$ pip install shadowsocks
#+end_src
**** 3.åˆ›å»ºé…ç½®æ–‡ä»¶
åœ¨/etcç›®å½•ä¸‹æ·»åŠ æ–‡ä»¶å¤¹shadowsocks
#+begin_src shell
$ mkdir /etc/shadowsocks
#+end_src
åˆ›å»ºé…ç½®æ–‡ä»¶shadowsocks.json
#+begin_src shell
$  vi /etc/shadowsocks/shadowsocks.json
#+end_src
æŒ‰iè¿›å…¥vimçš„insertæ¨¡å¼ç²˜è´´ä»¥ä¸‹ä»£ç 
å•ç«¯å£å•è´¦æˆ·
#+begin_src json
{
    "server":"server_ip",
    "server_port":8388,
    "local_address": "127.0.0.1",
    "local_port":1080,
    "password":"yourPassword",
    "timeout":300,
    "method":"aes-256-cfb",
    "fast_open": false
}
#+end_src
å¤šç«¯å£å¤šè´¦æˆ·
#+begin_src json
{
 "server":"yourServerIp",
 "_comment": {
 "8380":"me",
 "8381": "girl",
 "8382": "godness"
},
 "local_address":"127.0.0.1",
 "local_port":1080,
 "port_password":{
 "8380":"pc9527",
 "8381":"pc9527",
 "8382":"pc9527"
},
 "timeput":300,
 "method":"aes-256-cfb",
 "fast_open":false
}
#+end_src
æ­¤å¤„methodä¸ºåŠ å¯†æ–¹å¼ï¼ˆmethodï¼‰ï¼Œæˆ‘åœ¨æœ‰äº›é…ç½®æ•™ç¨‹ä¸­çœ‹åˆ°æœ‰æ¨èä½¿ç”¨rc4-md5ï¼Œä½†æ˜¯å®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºå®‰å…¨åº¦è¾ƒä½
ä»¥ä¸‹è¿˜æœ‰å‡ ä¸ªä¸æ¨èåŠ å¯†æ–¹å¼
| Name     | Key Size | IV Length |
|----------+----------+-----------|
| bf-cfb   |       16 |         8 |
|----------+----------+-----------|
| chacha20 |       32 |         8 |
|----------+----------+-----------|
| salsa20  |       32 |         8 |
|----------+----------+-----------|
| rc4-md5  |       16 |        16 |
|----------+----------+-----------|
å…¶ä»–é…ç½®ä»¥åŠåŠ å¯†æ–¹å¼å¯å‚è€ƒæ”¹æ–‡æ¡£[[https://wiki.archlinux.org/index.php/Shadowsocks_(ç®€ä½“ä¸­æ–‡)#é…ç½®ä»£ç†
]]å¯åŠ¨
#+begin_src shell
$ sudo ssserver -c /etc/shadowsocks/shadowsocks.json -d start
#+end_src
åœæ­¢
#+begin_src shell
$ ssserver -c /etc/shadowsocks/shadowsocks.json -d stop
#+end_src
å¯åŠ¨é…ç½®æ–‡ä»¶
#+begin_src shell
$ ssserver -c /etc/shadowsocks/shadowsocks.json --user nobody -d start
#+end_src
*** æ‰“å¼€é˜²ç«å¢™
æŸ¥çœ‹é»˜è®¤é˜²ç«å¢™çŠ¶æ€ï¼ˆå…³é—­åæ˜¾ç¤ºnotrunningï¼Œå¼€å¯åæ˜¾ç¤ºrunningï¼‰
#+begin_src shell
$ firewall-cmd --state
#+end_src
å¯åŠ¨firewall
#+begin_src shell
systemctl start firewalld.service
#+end_src
å¼€æ”¾xxxç«¯å£(å¤šç«¯å£å¤šè´¦æˆ·æƒ…å†µè¯·å¾ªç¯è°ƒç”¨â™»ï¸ï¼‰
#+begin_src shell
firewall-cmd --zone=public --add-port=8381/tcp --permanent
#+end_src
é‡å¯firewall
#+begin_src shell
firewall-cmd --reload
#+end_src
æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£
#+begin_src shell
firewall-cmd --list-ports
#+end_src
**** firewall-cmd å¸¸ç”¨å‘½ä»¤
| Command                  | Code                                                                                                                                 |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| å¼€å¯é˜²ç«å¢™               | systemctl start firewalld.service                                                                                                    |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| é˜²ç«å¢™å¼€æœºå¯åŠ¨           | systemctl enable firewalld.service                                                                                                   |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| å…³é—­é˜²ç«å¢™               | systemctl stop firewalld.service                                                                                                     |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€           | firewall-cmd --state                                                                                                                 |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| æŸ¥çœ‹ç°æœ‰çš„è§„åˆ™           | iptables -nL                                                                                                                         |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| é‡è½½é˜²ç«å¢™é…ç½®           | firewall-cmd --reload                                                                                                                |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| æ·»åŠ å•ä¸ªå•ç«¯å£           | firewall-cmd --permanent --zone=public --add-port=81/tcp                                                                             |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| æ·»åŠ å¤šä¸ªç«¯å£             | firewall-cmd --permanent --zone=public --add-port=8080-8083/tcp                                                                      |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| åˆ é™¤æŸä¸ªç«¯å£             | firewall-cmd --permanent --zone=public --remove-port=81/tcp                                                                          |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| é’ˆå¯¹æŸä¸ª IPå¼€æ”¾ç«¯å£      | firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source                                                                  |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
|                          | address="192.168.142.166" port protocol="tcp" port="6379" accept                                                                     |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
|                          | firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.233" accept"                                  |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| åˆ é™¤æŸä¸ªIP               | firewall-cmd --permanent --remove-rich-rule="rule family="ipv4" source address="192.168.1.51" accept"                                |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| é’ˆå¯¹ä¸€ä¸ªipæ®µè®¿é—®         | firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.0/16" accept"                                 |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
|                          | firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="9200" accept" |
|--------------------------+--------------------------------------------------------------------------------------------------------------------------------------|
| æ·»åŠ æ“ä½œååˆ«å¿˜äº†æ‰§è¡Œé‡è½½ | firewall-cmd --reload                                                                                                                |

*** è®¾ç½®shadowsockså¼€æœºè‡ªå¯
**** 1.å®‰è£…supervisor
#+begin_src shell
$ easy_install supervisor
#+end_src
**** 2.åˆ›å»ºé…ç½®æ–‡ä»¶
#+begin_src shell
$ echo_supervisord_conf > /etc/supervisord.conf
#+end_src
**** 3.ä¿®æ”¹é…ç½®æ–‡ä»¶
#+begin_src shell
$ vi /etc/supervisord.conf
#+end_src
**** 4.åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šï¼š
#+begin_src conf
[program:ssserver]
command = ssserver -c /etc/shadowsocks.json
autostart=true
autorestart=true
#+end_src
**** 5.è®¾ç½®supervisorå¼€æœºè‡ªå¯
#+begin_src shell
$ vi /etc/rc.local
#+end_src
åœ¨æ–‡ä»¶æœ«å°¾å¦èµ·ä¸€è¡Œï¼Œæ·»åŠ ï¼š supervisord
**** 6.CentOS7 è¿˜éœ€è¦ä¸º rc.local æ·»åŠ æ‰§è¡Œæƒé™
#+begin_src shell
$ chmod 777 /etc/rc.local
#+end_src
è¿™æ ·sså¼€å¯è‡ªåŠ¨åå°è¿è¡Œå°±é…ç½®å¥½äº†ï¼Œä¸‹é¢é‡å¯æœåŠ¡å™¨å°±å¥½äº†ï¼Œå¯ä»¥åœ¨digitaloceanæ§åˆ¶é¢æ¿ä¸­é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚
*** ä¼˜åŒ–
**** å†…æ ¸å‚æ•°ä¼˜åŒ–
è°ƒæ•´å†…æ ¸å‚æ•°
ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/sysctl.conf
#+begin_src confg
fs.file-max = 51200

net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.netdev_max_backlog = 250000
net.core.somaxconn = 4096

net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 0
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.ip_local_port_range = 10000 65000
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_congestion_control = hybla
#+end_src
è¿è¡Œsysctl -pç”Ÿæ•ˆ
#+begin_src shell
$ sysctl -p
#+end_src
**** é”é€ŸåŠ é€Ÿ
ç”±äºæœ¬äººç¼ºä¹Linuxæ–¹é¢çš„çŸ¥è¯†å¹¶ä¸”å¯¹é€Ÿåº¦æ²¡æœ‰å¤ªé«˜çš„è¦æ±‚ï¼Œå› æ­¤æš‚æ—¶ç•™å‘ï¼Œä¸è¿‡å¯ä»¥å‚è€ƒä»¥ä¸‹æ•™ç¨‹ï¼Œæˆ‘è§‰å¾—è®²çš„è¿˜æ˜¯æŒºæ¸…æ¥š
[[https://www.cmsky.com/serverspeeder-install/]]
[[https://www.cnblogs.com/semonxv/p/3816366.html
]]
åˆ é™¤ç«¯å£ï¼Œéœ€è¦å…ˆåœæ­¢é…ç½®æ–‡ä»¶æœåŠ¡ï¼Œç„¶ååˆ æ‰ç›¸åº”ç«¯å£
å¹¶ä¸”ç¦ç”¨å…¶é˜²ç«å¢™ç«¯å£

*** å…¶ä»–å‚è€ƒæ–‡ç« 
[[https://www.jianshu.com/p/e990897aeaec]]
[[http://wuchong.me/blog/2015/02/02/shadowsocks-install-and-optimize/]]
